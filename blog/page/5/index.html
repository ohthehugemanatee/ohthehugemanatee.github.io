
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Oh The Huge Manatee</title>
  <meta name="author" content="Campbell Vertesi (ohthehugemanatee)">

  
  <meta name="description" content="It seems like any time anyone has to configure a server for SSL/TLS, they treat it like some kind of voodoo magic. And I guess it can seem that way: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ohthehugemanatee.github.io/blog/page/5">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Oh The Huge Manatee" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-46172182-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Oh The Huge Manatee</a></h1>
  
    <h2>Drupal, Sysadminning, and Tech.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.duckduckgo.com/" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:ohthehugemanatee.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/20/ssl-certificates-demystified/">SSL Certificates Demystified</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-20T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It seems like any time anyone has to configure a server for SSL/TLS, they treat it like some kind of voodoo magic. And I guess it can seem that way: if you get your certificates in the right formats from your certificate authority, you basically just drop them into Apache/NGINX/whatever and let it go.&nbsp;</p>


<p>But what happens if those files&nbsp;<strong>aren&#8217;t</strong> in the right format by default? And what if you actually want to understand what&#8217;s going on with your server?</p>


<p>The truth is, encryption is not terribly difficult to understand. It&#8217;s a little tricky to explain, and the maths in the nitty gritty of it can get really intense, but a high level understanding is important for anyone who works with SSL.&nbsp;</p>


<div>The basis for SSL is <a href="https://en.wikipedia.org/wiki/Public_key_cryptography">public-key</a> (asymmetrical) cryptography. The idea is that you create a pair of files that have matching abilities:</div>


<div>&nbsp;</div>


<div>*<strong> the &#8220;public&#8221; file can&nbsp;encrypt&nbsp;content</strong> so that the matching &#8220;private&#8221; file must be used to decrypt it. It can also <strong>verify the signature</strong> of the &#8220;private&#8221; file.</div>


<div>&nbsp;</div>


<div>* <strong>the &#8220;private&#8221; file can&nbsp;decrypt&nbsp;content</strong> that was encrypted by the matching &#8220;public&#8221; file. It can also <strong>leave a unique digital signature</strong> which can be verified by the matching &#8220;public&#8221; file.</div>


<div>&nbsp;</div>


<div>If you&#8217;ve ever used the <a href="https://en.wikipedia.org/wiki/Pretty_Good_Privacy">PGP encryption</a> system, that&#8217;s basically how it works. You publish your public key in a publicly available directory, and keep your private key to yourself. That way, anyone can use your public key to encrypt content for you, and only you can decrypt it.</div>


<div>&nbsp;</div>


<div>In the context of web communications, this model is taken to the next level. We use the encryption aspect of it, but we also use those digital signatures. Here&#8217;s the process.</div>


<div>&nbsp;</div>


<div>1) You create this &#8220;key pair&#8221; for yourself, and hide the private key away somewhere. Optionally the private key can be password-protected.</div>


<div>&nbsp;</div>


<div>2) You create a Certificate Request file (.CSR, usually). A Certificate Request is just a copy of your Public Key, with some identifying information about your organization. The most important piece of this information is the domain name this Request is for. You submit your CSR file to a Certificate Authority (abbreviated as &#8220;CA) company like <a href="https://www.rapidssl.com/">RapidSSL</a>, or any number of other Certificate Authorities out there.</div>


<div>&nbsp;</div>


<div>3) The CA verifies that you really own the domain name specified in the CSR. How they verify that is up to the CA. Maybe they email the owner of the domain, maybe they ask you to modify a DNS record, maybe they just take you on your word (hopefully not!). Whatever they do, when the CA is satisfied that you really do own that domain name, they send you back your Certificate Request file. This version of the file is signed by the CA&#8217;s own private key, and that difference makes it the actual &#8220;SSL certificate&#8221; file. If you&#8217;ve been keeping score at home, the SSL certificate is simply your public key with your organizational information attached, and your CA&#8217;s signature.&nbsp;</div>


<div>&nbsp;</div>


<div>Great, now people can send you encrypted messages, right? Well, sorta. How do people know they can trust the CA? Maybe that CA is just some yahoo who lives up the hall, or your great aunt Edna. How can I trust Edna to vouch for you?&nbsp;</div>


<div>&nbsp;</div>


<div>4) The solution is a &#8220;chain of authority&#8221; file. This is just your CA&#8217;s public key (which the browser needs to check that signature on your SSL certificate, remember?). What makes this public key special is that it&#8217;s ALSO signed by whoever granted your CA permission to be a CA, and by whoever granted THAT person the permission to be a CA, all the way back to one of the &#8220;root&#8221; certificate authorities, whose public keys are bundled with every browser. (there are about 30 of them). So the chain file from aunt Edna might contain signatures from her daughter Annie, Annie&#8217;s company AnnieCA, and GeoTrust, who granted AnnieCA the authority to give out certificates. GeoTrust is a root CA, so your browser already knows they&#8217;re trusted. &nbsp;</div>


<div>&nbsp;</div>


<div>So when a web browser connects to your server, your server sends out its SSL certificate file (ie the server&#8217;s public key with Edna&#8217;s &#8220;Seal of Authenticity&#8221; on it). The browser can then encrypt communications to send to your server, and your server can decrypt them with its private key. The browser can also check on Edna&#8217;s Seal of Authenticity, because there&#8217;s a chain of other CAs who have signed Edna&#8217;s certificate, right back to one of the CAs that the browser already trusts.</div>


<div>&nbsp;</div>


<div>With a one-way secure channel open, and with confidence that your server really does own that public key, the browser sends its own public key to the server. This is really as far as you need to understand in order to set up your own webserver. Once the server and browser have exchanged public keys, the rest is automatic. For the sake of completion in this blog post, you should know that they don&#8217;t continue using this asymmetric encryption for long. This secure channel is only used to set up a symmetric encryption method - that is, an encryption method where both sides have identical keys for encryption and decryption. &nbsp;The actual content is sent over this symmetrically encrypted connection, because symmetrical encryption is lighter on the CPU and the data overhead, and is actually harder to break.</div>


<div>&nbsp;</div>


<div>All we sysadmins really care about is the handshake, because that&#8217;s where all those confusing key files go. So, TL;DR time. Here&#8217;s what you need:</div>


<div>&nbsp;</div>


<div>1) Your server&#8217;s private key file. Note that this can be encrypted with a password, but most web hosts would rather you not. If there&#8217;s a password, someone has to enter it every time they restart the server!</div>


<div>2) The SSL Certificate, signed by your Certificate Authority.</div>


<div>3) Your Certificate Authority&#8217;s chain of intermediate certificates.</div>


<div>&nbsp;</div>


<div>Most (Drupal-centric) web hosts will want all of these in PEM format. PEM is a text format, which means you can just copy and paste the key around. If your certificates are in another format, it&#8217;s pretty easy to convert them to PEM with the openssl command, like this:</div>


<div>&nbsp;</div>


<div>
<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag"> openssl &lt;old-cert-format&gt; -in old-cert-file -out new-cert-file.pem </pre>
</div>


<div>There are also a handful of options that can come in handy in specifying the output, but they really go beyond the scope of this blog post. The resource I always use is the <a href="https://twiki.cern.ch/twiki/bin/view/LinuxSupport/OpenSSLCheatsheet">CERN openSSL conversions cheat sheet</a>.&nbsp;</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/21/review-geoserver-beginners-guide-by-stefano-iacovella-and-brian-youngblood/">Review: GeoServer Beginner&#8217;s Guide, by Stefano Iacovella and Brian Youngblood</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-21T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently we&#8217;ve been holding <a href="http://5ringsweb.com/blog/geoserver-beginners-guide-free-copies">a competition</a> to give away free copies of the popular ebook, <a href="http://www.packtpub.com/geoserver-share-edit-geospatial-data-beginners-guide/book">GeoServer Beginner&#8217;s Guide</a>. The book&#8217;s purpose is to teach through practical examples. Right on the cover, it promises: &#8220;Less theory, more results!&#8221; This is a tricky balance to strike in a beginner&#8217;s guide. You can&#8217;t simply jump into coding a map display when the user doesn&#8217;t understand the fundamental concepts! But authors Brian Youngblood and Stefano Iacovella find a good middle ground.</p>


<p>The first chapter explains totally fundamental GIS concepts, answering basic questions like &#8220;what is spatial data?&#8221; And &#8220;What is a projection?&#8221; and defining some key terms like &#8220;vector&#8221; versus &#8220;raster&#8221; displays. This section tried to be very thorough and gently ramp total newcomers into the world of GIS. When I started reading, I was surprised at the amount of time they spent on these basics - when they say &#8220;beginner,&#8221; they mean it!</p>


<p>The following two chapters take the same meticulous approach to setting up Geoserver and using its administrative web interface. While this section of the book was impressively thorough, the target level of expertise was uneven. Some parts seemed targeted for my grandmother&#8217;s level of understanding, others seemed to assume a basic knowledge of geo concepts. For example, we got a great explanation of map projections, Universal Transverse Mercator versus Web Mercator, with cases where you might use each. We even explore the EPSG Registry for some exotic projections. But the differences between WMS, WFS, and WCS are explained with one line each. Or the fact that we have the fundamental concept of REST explained, but the examples assume a medium level of comfort with Javascript.</p>


<p>Since the expected learning curve for this eBook is a bit uneven, sections of these opening chapters get slow to read. Do we really need an explanation of EVERY SINGLE LINK in the Geoserver administrative interface? Surely the &#8220;about&#8221; link could have been skipped. Or the section on defining your own log level. My grandmother would never need to define her own log level to get started using Geoserver - in fact, I&#8217;ve used it for years and never needed this functionality. Meticulously explaining every single possibility of the administrative interface made this section of the book seem like it was duplicating the Geoserver Documentation pages.</p>


<p>Once the core concepts and functionalities are introduced however, the book really starts to shine. I found it picked up at about Chapter 6, which explains in great detail how to write your own SLD files and style your map output. The moment practical examples of any depth are introduced, it seems like we hit the authors&#8217; comfort zone: really teaching by doing. They both have a lot of experience in GIS, and offer top quality code examples to follow.&nbsp;</p>


<p>I&#8217;ve worked a fair amount with GIS, but partway through the section on writing your own SLD I started to learn new aspects of this technology I had used so many times. By the time I got into Chapter 8, practical examples of building maps with Google Maps API, OpenLayers, and Leaflet, I started to take notes for myself. The following 4 chapters maintain this impressive stride: lots of information delivered, in a clear and practical way, with code examples that are worth consulting over and over again in your own work.</p>


<p>I would not recommend the GeoServer Beginner&#8217;s Guide for total beginners. The core basics of GIS are probably better explained in texts that remain focused on the fundamental concepts. But for those of us who have worked with GIS before, who have perhaps gotten by with some gaps in their knowledge, I recommend it strongly. The basics chapters are worth skimming to fill in conceptual gaps, and when the book gets moving it REALLY gets moving.&nbsp; If you have a technical background, and want to build or seriously strengthen your GIS toolkit, the <a href="http://www.packtpub.com/geoserver-share-edit-geospatial-data-beginners-guide/book">GeoServer Beginner&#8217;s Guide</a> is a great choice. It offers you clear explanation of the most powerful Open Source GIS offerings out there, and comes with many clear, well-written examples. These make it a fantastic resource, which has earned a permanent place on my bookshelf.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/18/how-to-set-up-apache-solr-multicore-for-drupal/">How to Set Up Apache Solr Multicore for Drupal</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-18T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://lucene.apache.org/solr/" target="_blank">Apache Solr</a> is the search technology that powers many <a href="http://drupal.org">Drupal</a> sites. It integrates easily with Drupal&#8217;s <a href="http://drupal.org/project/search_api" target="_blank">search_api</a> contrib module, through the <a href="http://drupal.org/project/search_api_solr" target="_blank">search_api_solr</a> module. It&#8217;s easy enough to set up a single site installation of solr on your own, but if you&#8217;re serious about building Drupal sites with solr you will be building more than one site. Solr includes a &#8221;<a href="http://wiki.apache.org/solr/CoreAdmin" target="_blank">multi-core</a>&#8221; mode, which lets you serve multiple search cores to separate sites from a single installation. Each core looks, feels, and acts like a totally separate Solr install, so you can develop as many solr sites as you like. Each core has its own configuration, data directory&#8230; the works. One core can support extensive custom geo data, and another can be completely location blind. The best part: with Solr multicore, adding a new search core to your existing stack is a trivial 5 minute installation.</p>


<p>But getting a working, sane, and easy to manage solr multicore installation is not quite as trivial as a single site. I get asked for instructions on this all the time, so here they are for posterity. These instructions assume you&#8217;re running on a supported version of <a href="http://www.ubuntu.com/" target="_blank">Ubuntu Linux</a>, but very few steps are distribution-specific. I&#8217;ve noted them inline, so you can work out just what you need to do for your unique environment.</p>


<h3>1) Understand what you&#8217;re doing</h3>


<p>I know you aren&#8217;t going to read this whole post before getting started, so instead step 1 is to understand the beast.</p>


<p>Drupal&#8217;s <a href="http://drupal.org/project/search_api" target="_blank">search_api</a> module allows you to plug in different search engines to act as the back end. We&#8217;re going to use the <a href="http://drupal.org/project/search_api_solr" target="_blank">search_api_solr</a> module, so that Drupal passes search indexing and queries to Apache Solr for processing. Installing and configuring this on the Drupal side is beyond the scope of this post, but it&#8217;s not radically different from any other contrib module. The radically different part is in setting up Solr, and making sure it knows how to understand the information coming from Drupal.&nbsp;</p>


<p><a href="https://lucene.apache.org/solr/" target="_blank">Apache Solr</a> is a search engine built in Java. Basically you run a java program, feed it a bunch of data, and it stores it in a searchable index. Then you send it search queries, and it gives you a sorted list of results. In order to do this, it needs to understand the structure of the data in the search index, and a handful of similar details. We&#8217;re lucky in that Drupal&#8217;s search_api_solr comes with exactly the configuration files we need to make Solr understand the indexing and search request data that comes from Drupal. We&#8217;ll be able to just copy the configuration files right out of the search_api_solr.</p>


<p>In order to run solr in a secure environment, and in order to feed it information that&#8217;s coming in over HTTP, you need a Java Servlet engine. This is basically a web server that is specifically built to pass requests on to Java applications like Solr. You can think of it as a wrapper for Solr. There are a few competing open source servlet engines, but we&#8217;re going to use <a href="https://tomcat.apache.org/" target="_blank">Tomcat</a> in this tutorial. Tomcat is popular, powerful, and easy to install on most modern Linux distributions.&nbsp;</p>


<h3>2) Install Apache Tomcat</h3>


<p>On Ubuntu and Debian systems, this should be as easy as&nbsp;</p>


<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">sudo apt-get install tomcat6 tomcat6-admin tomcat6-common tomcat6-user</pre>


<div>Bam, you have tomcat installed, as well as everything you need for tomcat to control access to administrative and user functions. The default location for tomcat6 is <span style="font-family: 'courier new', courier, monospace;">/usr/share/tomcat6</span> , and configuration is stored in <span style="font-family: 'courier new', courier, monospace;">/etc/tomcat6</span> .</div>


<p>By default Tomcat&#8217;s user database is a simple xml file. We&#8217;re going to edit it so that we have an administrative user that can tweak behaviors from Tomcat&#8217;s web interface.</p>


<pre class="brush: xml; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="sudo vi /etc/tomcat6/tomcat-users.xml"><span style="font-family: Arial, Verdana, sans-serif;">&lt;role rolename="admin"/&gt;
&lt;role rolename="manager"/&gt;
&lt;user username="tomcat" password="mypasswordhere" roles="admin,manager"/&gt;
&lt;/tomcat-users&gt;
</span></pre>


<div><span style="background-color: rgb(250, 250, 250); line-height: 18px; white-space: pre;">Make sure that you define both the admin and manager roles as above, and that you have one user that gets both roles. Save the file, and restart the tomcat6 service.</span></div>


<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">sudo service tomcat6 restart</pre>


<p><span style="color: rgb(51, 51, 51); font-family: arial, 'lucida grandriale', 'lucida sans unicode', tahoma, sans-serif; line-height: 18px;">Now Tomcat is up and running, and you can administer it. By default the administrative interface runs on port 8080. This is actually quite handy to keep around, so I recommend blocking external access to 8080 at the firewall level, and accessing it locally when you need to make configuration changes or tests. Test it out now at http://localhost:8080/ . By default you should see a page that shows links to the administration sections, and some other generic information about your Tomcat instance.</span></p>


<h3>2) Install Apache Solr</h3>


<div><em>Note: as of this writing, search_api_solr is not yet compatible with the latest major version of Solr (4.1). You can track progress on this issue at <a href="http://drupal.org/node/1676224" target="_blank">http://drupal.org/node/1676224</a> . In the meantime, we&#8217;re proceeding with a current version of 3.6. These instructions should work for the latest 3.6.x you can find on the Solr website.</em></div>


<div>&nbsp;</div>


<div><br>Now we&#8217;re going to download the Solr Java application, and copy the compiled version of it into tomcat&#8217;s jailed &#8220;webapps&#8221; directory, where it&#8217;s safe to run. We&#8217;re also going to create a convenience simlink there so we can keep the version information in the filename, and we don&#8217;t have to update any config files when we want to update Solr versions. Finally, we&#8217;re going to simlink solr&#8217;s configuration directory to&nbsp;<span style="font-family: 'courier new', courier, monospace;">/etc/solr</span> , so you don&#8217;t have to memorize the location.</div>


<div>
<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">cd /tmp
wget http://apache.rediris.es/lucene/solr/3.6.2/apache-solr-1.4.1.zip
unzip apache-solr-3.6.3.zip</pre>
</div>


<div><div><p>Now we create a directory for Solr to keep its compiled Java applications in, right in tomcat&#8217;s homedir because that will be easy to find later. We copy the compiled .war file for solr into that new directory, and simlink it to an easier to remember name that we can use in configuration files.</p>
<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">sudo mkdir /usr/share/tomcat6/webapps
sudo cp /tmp/apache-solr-3.6.3/dist/apache-solr-3.6.3.war /usr/share/tomcat6/webapps
sudo ln -s /usr/share/tomcat6/webapps/apache-solr-3.6.3.war /usr/share/tomcat6/webapps/solr.war</pre>
</div><div>Now technically we have the solr application installed&#8230; but Solr needs for its own home directory as well. This is where you will keep solr-specific configuration files, and eventually the files related to your search cores themselves. We&#8217;ll base our solr directory off of the example multicore setup that is distributed with solr itself. This directory needs to be writable by solr so it can keep search index information in it, so we have to make sure it&#8217;s owned by tomcat6 (the user who will be running solr). Finally, we&#8217;ll simlink solr&#8217;s home directory to /etc/solr&nbsp;so it&#8217;s more memorable.</div><div>
<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">sudo cp -a /tmp/apache-solr-3.6.3/example/multicore /usr/share/tomcat6/solr
sudo chown -R tomcat6 /usr/share/tomcat6/solr
sudo ln -s /usr/share/tomcat6/solr /etc/solr</pre>
</div><div>Solr is now ready to go. Let&#8217;s tell tomcat6&#8217;s servlet container component, Catalina, about solr and what access it needs to run. We describe a new &#8220;Context&#8221; to Catalina, which is based on the solr.war simlink we just created. We tell it where to find the environment solr.war calls &#8220;solr/home&#8221;, which is the solr homedir we just set up.&nbsp;</div></div>


<div><div>
<pre class="brush: xml; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="sudo vi /etc/tomcat6/Catalina/localhost/solr.xml">&lt;Context docBase="/usr/share/tomcat6/webapps/solr.war" debug="0" privileged="true" allowLinking="true" crossContext="true"&gt;
&nbsp; &lt;Environment name="solr/home" type="java.lang.String" value="/usr/share/tomcat6/solr" override="true" /&gt;
&lt;/Context&gt;</pre>
<div>Restart tomcat6 with <span style="font-family: 'courier new', courier, monospace;">sudo service tomcat6 restart</span>, so it reads the new configuration. Now we have a multi-core solr environment set up to run on Tomcat6. Congratulations! The hard part is over. Test to make sure solr is loading properly by visiting your Tomcat admin page at <span style="font-family: 'courier new', courier, monospace;">http://localhost:8080/manager/html</span> . You should see new links there for solr, with two example cores already built in.</div></div><h3>3) Configure Solr Multicore for Convenience</h3><div>Let&#8217;s have a look at the solr configuration you just created. In your <span style="font-family:courier new,courier,monospace;">/etc/solr</span> directory, you actually only need one file: <span style="font-family:courier new,courier,monospace;">solr.xml</span> . This configuration file tells solr everything it needs to know about how it is set up. In fact, the only part you have to care about is at the end, where it lists <span style="font-family:courier new,courier,monospace;">&lt;core&gt;</span> declarations.&nbsp;</div><div>
<pre class="brush: xml; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="vi /etc/solr/solr.xml">&lt;cores adminPath="/admin/cores"&gt;
&nbsp; &lt;core name="core0" instanceDir="core0" /&gt;
&nbsp; &lt;core name="core1" instanceDir="core1" /&gt;
&lt;/cores&gt;</pre>
</div><div>Each new core gets a name and a directory path (relative to solr&#8217;s home,<span style="font-family:courier new,courier,monospace;"> /etc/solr</span>) where it should keep it&#8217;s configuration and data. By default we have two demonstration cores, called <span style="font-family:courier new,courier,monospace;">core0</span> and <span style="font-family:courier new,courier,monospace;">core1</span>, kept right in Solr&#8217;s home directory. I find that messy, so we&#8217;re going to create a new directory called <span style="font-family:courier new,courier,monospace;">cores</span>, and give each core a subdirectory under that. Then we&#8217;ll update that <span style="font-family:courier new,courier,monospace;">solr.xml</span> file to tell it the new location of <span style="font-family:courier new,courier,monospace;">core0</span> and <span style="font-family:courier new,courier,monospace;">core1</span>. This is purely for convenience and clarity of configuration, but when you have 20 concurrent solr dev sites to manage, you&#8217;ll thank me.</div><div>
<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">sudo mkdir /etc/solr/cores
sudo mv /etc/solr/core[0-1] /etc/solr/cores</pre>
</div><div>
<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="sudo vi /etc/solr/solr.xml">&lt;cores adminPath="/admin/cores"&gt;
&nbsp; &lt;core name="core0" instanceDir="cores/core0" /&gt;
&nbsp; &lt;core name="core1" instanceDir="cores/core1" /&gt;
&lt;/cores&gt;</pre>
<div>That&#8217;s it. If all you want is a Solr multicore setup, this is where you get off. From here on in it&#8217;s Drupal-specific.</div></div><h3>4) Add a new core for a Drupal site</h3><div>Now that everything is nicely organized in <span style="font-family:courier new,courier,monospace;">/etc/solr</span>, let&#8217;s add a new search core for a Drupal site. We&#8217;re going to copy one of the example core directories, and then copy in the configuration files that are distributed with Drupal&#8217;s search_api_solr module. With each new site, I recommend copying in these configuration files from the module rather than trusting what&#8217;s in an existing core directory, simply because these configurations update with the search_api_solr module itself. You want to make sure that your core is using the configuration that your version of the module expects! <em>These are the steps you will have to take every time you want to add a new core for a Drupal site.</em></div><div>
<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">sudo cp -a /etc/solr/cores/core0 /etc/solr/cores/myfirstcore
sudo cp /path/to/drupal_site/sites/all/modules/search_api_solr/solr-conf/* /etc/solr/cores/myfirstcore/conf</pre>
</div><div>
<pre class="brush: xml; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="sudo vi /etc/solr.xml">&lt;cores adminPath="/admin/cores"&gt;
&nbsp; &lt;core name="core0" instanceDir="cores/core0" /&gt;
&nbsp; &lt;core name="core1" instanceDir="cores/core1" /&gt;
&nbsp; &lt;core name="myfirstcore" instanceDir="cores/myfirstcore" /&gt;
&lt;/cores&gt;
</pre>
</div><div>
<pre class="brush: bash; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag">sudo chown -R tomcat6 /etc/solr/
sudo service tomcat6 restart</pre>
</div><div>That&#8217;s it. Copy a directory, add one line to a configuration file, and restart tomcat6, and you have a new solr core to work with.</div><h3>5) Profit</h3><div>Now that your solr core is up and running, you can visit the search_api_solr configuration page and add a new server of type &#8220;solr&#8221;, with the following settings:</div><div>&nbsp;</div><div><strong>Solr Hostname</strong>: localhost</div><div>&nbsp;</div><div><strong>Solr Port</strong>: 8080</div><div>&nbsp;</div><div><strong>Solr Path</strong>: /solr/myfirstcore</div><div>&nbsp;</div><div>Test and enjoy! If you have any trouble with these instructions, or have anything to add&#8230; leave us a comment!</div></div>


<p>&nbsp;</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/18/adding-rules-to-your-contrib-module-so-you-can-reject-half-the-tickets-in-your-queue/">Adding Rules to Your Contrib Module (So You Can Reject Half the Tickets in Your Queue)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-18T00:00:00+02:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://drupal.org" target="_blank">Drupal&#8217;s</a> <a href="http://drupal.org/project/rules" target="_blank">Rules module</a> lets site builders define complex and custom behaviors without having to code a custom module. That puts a lot of power in the hands of the site builder, and it makes developers (rightly) nervous. But there&#8217;s another way to think about it.</p>


<p>What&#8217;s fantastic about Rules is that it lets everyone who wants your module to behave slightly differently to <em>change the behavior for themselves</em>. In fact, if you build the logic of your module into Rules you get&nbsp;an excuse to reject half the tickets in your contrib module queue on the grounds of &#8220;works as intended,&#8221; aka &#8220;do it yourself.&#8221; &nbsp;To me, this is the quiet brilliance of Commerce module&#8217;s dependence on Rules. Their code is almost 100% functional elements, with as little behavioral logic as possible. All of the logic is written in Rules. Of course they still distribute Commerce with a hefty set of default rules, so it works with a standard implementation out of the box. But at the same time, it is open to completely custom workflows without the developers ever having to get involved.</p>


<p>Today we&#8217;re going to cover adding Rules to existing code. This is an easy way to write solid and useful patches for other contrib modules out there, patches that get used. For your own projects you will probably want to implement this code in your own custom module, just hooking into core or contrib behaviors. Either way the logic is the same.</p>


<p>At it&#8217;s core, the Rules API lets you expose functions you&#8217;ve already written to the GUI. 90% of the work is just declaring the functions. There are three elements that Rules cares about:</p>


<ul><li><strong>Events</strong>: Potential triggers that a user can use to take action with Rules.</li><li><strong>Actions</strong>: Functions which take a set of parameters and do something.&nbsp;</li><li><strong>Conditions</strong>: Test functions, which return <span style="font-family:courier new,courier,monospace;">TRUE</span> or <span style="font-family:courier new,courier,monospace;">FALSE</span>.</li></ul>


<p>You declare these elements to Rules with hooks, usually assembled into a separate <span style="font-family:courier new,courier,monospace;">modulename.rules.inc</span> file. First, let&#8217;s define an event with <span style="font-family:courier new,courier,monospace;"><a href="http://drupalcontrib.org/api/drupal/contributions!rules!rules.api.php/function/hook_rules_event_info/7" target="_blank">hook_rules_event_info()</a></span>.</p>


<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="mymodule.rules.inc">&lt;?php
/**
* Implements hook_rules_event_info().
* Fire a Rules event when a node is validated.
*/
function mymodule_rules_event_info() {
&nbsp; return array(
&nbsp;&nbsp;&nbsp; 'mymodule_node_is_being_validated' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'group' =&gt; t('My module'),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'label' =&gt; t('A node is being validated!'),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'variables' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'node' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'node',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'label' =&gt; t('unsaved node being validated'),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),
        'form_id' =&gt; array(
          'type' =&gt; 'text',
          'label' =&gt; t('Form ID'),
        ),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),
&nbsp;&nbsp;&nbsp; ),
  );
}
?&gt;
</pre>


<p>This implementation tells rules that you are defining an Event with the machine name <span style="font-family: 'courier new', courier, monospace;">mymodule_node_is_being_validated</span>. In the Rules dropdown select box that lets you choose the triggering action for a new rule, your Event is called &#8220;A node is being validated!&#8221; and is sorted into the group &#8220;My Module&#8221;. &nbsp;The variables array sets the variables that are offered with this particular event. Each variable in the array must have a &nbsp;machine name (the key), a human-readable label and a data type. Now, anywhere that you want to fire this rules event, you call it with&nbsp;<span style="font-family: 'courier new', courier, monospace;">rules_invoke_event(&#8216;mymodule_node_is_being_validated&#8217;, $node)&nbsp;</span>to fire the Event. In this case, you could hook into node validation and add it easily enough:</p>


<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="mymodule.module">&lt;?php
/**
* Implements hook_node_validate().
* Fires our Rules event on node validation.
*/
function mymodule_node_validate($node, $form, &amp;$form_state) {
  rules_invoke_event('mymodule_node_is_being_validated', $node, $form['#form_id']);
}
?&gt;
</pre>


<p>This example brings up one of the big limitations of Rules: you can&#8217;t fail validation. We can set an error message, respond with all the power of Rules, but no matter what you do you cannot make this node form fail validation. The good people at <a href="http://drupal.org/project/rules_forms" target="_blank">rules_forms</a> module are trying to address this, but it&#8217;s a much thornier problem than it looks.</p>


<p>Next, let&#8217;s define a Rules action with <span style="font-family:courier new,courier,monospace;"><a href="http://drupalcontrib.org/api/drupal/contributions%21rules%21rules.api.php/function/hook_rules_action_info/7" target="_blank">hook_rules_action_info()</a></span>. This time we&#8217;ll use a real world use case from a recent client: our Rules Action will allow you to subscribe a user to a node with the <a href="http://drupal.org/project/subscriptions" target="_blank">subscriptions</a> module. Again, we&#8217;ll add this info implementation to our <span style="font-family:courier new,courier,monospace;">mymodule.rules.inc</span> file for clarity.</p>


<p>&nbsp;</p>


<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="mymodule.rules.inc">&lt;?php
/**
* Implements hook_rules_action_info()
* Add a Rules Action for subscribing a user to a node.
*/
function mymodule_rules_action_info() {
&nbsp; return array(
&nbsp;&nbsp;&nbsp; 'mymodule_subscribe_user_to_a_node' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'label' =&gt; t('Subscribe a user to a node'),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'group' =&gt; t('Subscriptions'),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'parameter' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'user' =&gt; array(
          'type' =&gt; 'user',
          'label' =&gt; 'Subscribing user',
        ),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'node' =&gt; array(
          'type' =&gt; 'node',
          'label' =&gt; 'Target node',
        ),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),
&nbsp;&nbsp;&nbsp; ),
&nbsp; );
}
?&gt;
</pre>


<p>&nbsp;</p>


<p>You can see that we use the same <span style="font-family:courier new,courier,monospace;">label</span>, <span style="font-family:courier new,courier,monospace;">group</span>, and <span style="font-family:courier new,courier,monospace;">module</span> declarations here. Actions take parameters as well, which are structured very similarly to the <span style="font-family:courier new,courier,monospace;">variables</span> in events. You don&#8217;t have to do anything more to make an action: this is it. When Rules fires the action it will look for a function called <span style="font-family:courier new,courier,monospace;">mymodule_subscribe_user_to_a_node</span>, and fire it with the parameters provided in the GUI. In this case we wrapped our own function around subscribe module&#8217;s functionality, because of the way subscribe&#8217;s own subscription function works.</p>


<p>&nbsp;</p>


<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="mymodule.module">&lt;?php
/**
* Creates a subscription for the user
*
* @param $user
*&nbsp; The user to subscribe to the node.
* @param $node
*&nbsp; The node to which the user will subscribe.
*/
function mymodule_subscribe_user_to_a_node($user, $node) {
&nbsp; module_load_include('inc', 'subscriptions', 'subscriptions.admin');
&nbsp; if (!is_object($node) || !isset($node-&gt;nid)) {
&nbsp;&nbsp;&nbsp; watchdog('rules_subscriptions', 'Error: object passed is not node. Data: !node', array('!node' =&gt; print_r($node, true)), WATCHDOG_ERROR);
&nbsp;&nbsp;&nbsp; return;
&nbsp; }
&nbsp; $form_state = array(
&nbsp;&nbsp;&nbsp; 'values' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'stype' =&gt; 'node',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'sid' =&gt; $node-&gt;nid,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'uid' =&gt; $user-&gt;uid,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'author_uid' =&gt; NULL,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'send_interval' =&gt; _subscriptions_get_setting('send_interval', $user),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'updates' =&gt; _subscriptions_get_setting('send_updates', $user),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'comments' =&gt; _subscriptions_get_setting('send_comments', $user),
&nbsp;&nbsp;&nbsp; ),
&nbsp; );
&nbsp; drupal_form_submit('subscriptions_add_form', $form_state, 'node', $node-&gt;nid);
}
?&gt;
</pre>


<p>&nbsp;</p>


<p>So much for Rules actions - they&#8217;re even easier than events! &nbsp;There is one big defining difference for Actions though: they can provide new variables back to Rules. This is as easy as a <span style="font-family:courier new,courier,monospace;">provides</span> array in <span style="font-family:courier new,courier,monospace;">hook_rules_action_info()</span>, and returning an array of values from the actual function called.&nbsp;</p>


<p>Now let&#8217;s look at a Rules condition. No surprise by now, we declare the existence of our Rules Condition through <span style="font-family:courier new,courier,monospace;"><a href="http://drupalcontrib.org/api/drupal/contributions!rules!rules.api.php/function/hook_rules_condition_info/7" target="_blank">hook_rules_condition_info()</a></span>&nbsp;in <span style="font-family:courier new,courier,monospace;">mymodule.rules.inc</span>&nbsp;:</p>


<p>&nbsp;</p>


<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="mymodule.rules.inc">&lt;?php
/**
* Implements hook_rules_condition_info().
* Checks if the given user is admin.
*/
function mymodule_rules_condition_info() {
&nbsp; return array(
&nbsp;&nbsp;&nbsp; 'mymodule_user_is_admin' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'group' =&gt; t('My Module'),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'label' =&gt; t('User is Admin'),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'parameter' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'user' =&gt; array(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'type' =&gt; 'user',
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 'label' =&gt; t('User to test'),
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ),
&nbsp;&nbsp;&nbsp; ),
&nbsp; );
}
?&gt;
</pre>


<p>&nbsp;</p>


<p>Once again we see the familiar structure to declare what is about to happen. And just like in an Action, Rules is going to fire a function named after the array key, <span style="font-family:courier new,courier,monospace;">mymodule_user_is_admin</span>, with the parameters provided. Here we&#8217;ll have a very simple function to check this, and it has to return <span style="font-family:courier new,courier,monospace;">TRUE</span> or <span style="font-family:courier new,courier,monospace;">FALSE</span>.&nbsp;</p>


<p>&nbsp;</p>


<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="mymodule.module">&lt;?php
function mymodule_user_is_admin($user) {
  if ($user-&gt;uid == '1') {
    return TRUE;
  }
  return FALSE;
}
?&gt;
</pre>


<p>Great, so now your module is fully integrated with Rules, right? Well, you have to actually include the Rules logic with the module. Rules provides hook_rules_default_configuration for you to do this, but writing rules by hand is a pain. The shortcut solution is to build your Rules in the Rules GUI and export them, and paste the export into your code. <a href="http://drupalcontrib.org/api/drupal/contributions%21entity%21entity.module/7" target="_blank"><span style="font-family:courier new,courier,monospace;">entity_import()</span></a> is a handy function from the <a href="http://drupal.org/project/entity" target="_blank">EntityAPI</a> module you can use to translate the export format into the format Rules needs. Here&#8217;s a sample <span style="font-family:courier new,courier,monospace;">(hook_rules_default_configuration</span> must be implemented in <span style="font-family:courier new,courier,monospace;">mymodule.rules_defaults.inc</span>):</p>


<p>&nbsp;</p>


<pre class="brush: php; auto-links: true; collapse: false; first-line: 1; html-script: false; smart-tabs: true; tab-size: 4; toolbar: true; codetag" title="mymodule.rules_defaults.inc">&lt;?php
/**
* Implements hook_default_rules_configuration().
*/
function mymodule_default_rules_configuration() {
&nbsp; $rules = array();
  $rules['rules_mymodule_behavior'] = entity_import(
    'rules_config',&nbsp;
    '............');
  return $rules;
}</pre>


<p>Note that the new rule name has to be prefixed with <span style="font-family:courier new,courier,monospace;">rules_</span>&nbsp;. &nbsp;That&#8217;s all you need to do.</p>


<p>What&#8217;s wonderful about these functions is how simple they are. Depending on how your module is written, adding Rules support could be as simple as adding calls to <span style="font-family: 'courier new', courier, monospace;">hook_rules_event_info()</span>, <span style="font-family: 'courier new', courier, monospace;">hook_rules_action_info()</span>, and <span style="font-family: 'courier new', courier, monospace;">hook_rules_condition_info()</span> that connect to existing functions already in your module. In 10 minutes or less, you can open your module up to much more flexibility than was ever possible before. And if you dare to prune the functionality out of your existing code, you can build it in the Rules GUI, export it, and have all your logic exposed and totally customizable in a further 15 minutes. That&#8217;s less than half an hour, and you can start training your users to deal with their own problems. :)</p>


<p>Questions? Problems? Leave us a message in the comments&#8230;</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/03/how-to-uninstall-dolly-drive.html">How to Uninstall Dolly Drive</a></h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2013-03-05T12:37:00+01:00" pubdate data-updated="true">Mar 5<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content">
<div class="css-full-post-content js-full-post-content">
I recently tried the Dolly Drive backup service, and decided it wasn&#8217;t for me. Foolishly, I uninstalled it the way you uninstall everything on OSX: by dragging it&#8217;s Application icon to the Trash. I thought it was gone for good&#8230; it wasn&#8217;t until weeks later that I noticed my system would gradually slow down after boot.<br /><br />This is a brand new Macbook Pro, so there&#8217;s no good reason for slow down. As a first diagnostic step, I opened up the Console log viewer, and was greeted by thousands of log entries like this:<br /><br /><code>3/5/13 1:12:20.870 PM dssbackupd[163]: Unable to fetch mandatory server information. You don't have a working cache. Please, try again later.<br />3/5/13 1:12:20.871 PM dssbackupd[163]: Cache failed bootstrapping.<br />3/5/13 1:12:20.981 PM dollysync-util[393]: Warning: unable to serialize operation queue.<br /></code><br /><div><br />These were coming in at a rate of about 6-8 per second. This may or may not have been the reason my computer is slowing down (I&#8217;ll tell you in a few weeks), but at the very least they were having an impact on my ability to read logs!<br /><br />A little bit of digging turned up the connection between dollydrive and these binaries&#8230; as well as a few others it had left behind on my system. Of course, without an Application to run, these processes were just spinning away and erroring out. <br /><br />So here&#8217;s how to complete the uninstall process for Dolly Drive, if you&#8217;ve already ditched the application:<br /><ul><li>In your OSX Finder, hit the &#8220;Go&#8221; menu and select &#8220;Go to Folder&#8221;. Enter &#8220;~/Library&#8221; at the prompt.</li><li>In the Finder window that appears, navigate to Application Support , and scroll down to the two entries for Dolly Drive and Dolly Drive Revo, and drag them to the Trash.</li><li>Open a Terminal window (in Applications &gt; Utilities), and type the following commands (with Enter at the end of each):</li></ul><code>killall -9 dollycloned</code><br /><code>killall -9 dollysync-util<br />killall -9 dssbackup<br />killall -9 dssbackup-local</code><br /><code>killall -9 dssbackupd<br />killall -9 RevoScheduler</code></div><br />These commands shut down the various elements of DollyDrive which are currently running. Then empty your Trash. If the Trash complains about files in use, run the same &#8220;killall -9&#8221; command with the name of the file it complained about, and then try emptying again.<br /><br />Opening my log console again was sweet, sweet bliss. Reboot if you want to, but it&#8217;s not really necessary - the application is gone, and will not bother your system again.
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/06/announcing-resource-conflict-drupal.html">Announcing the Resource Conflict Drupal Module</a></h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2012-06-13T22:35:00+02:00" pubdate data-updated="true">Jun 13<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content">
<div class="css-full-post-content js-full-post-content">
I recently took over an aging Drupal module, <a href="http://drupal.org/project/resource_conflict">Resource Conflict</a>. It had a D6 version with a lot of outstanding bugs in the queue&#8230; I started by simply <a href="http://drupal.org/node/976522">rewriting it for D7 and my specific use case</a>, but ended up in a discussion with the module&#8217;s old maintainer about a total rewrite for&nbsp;<a href="http://drupal.org/project/entity">Entities</a>&nbsp;and&nbsp;<a href="http://drupal.org/project/rules">Rules</a>. So <a href="http://drupal.org/node/1575800">that&#8217;s what I did</a>, and I just released the <a href="http://ftp.drupal.org/files/projects/resource_conflict-7.x-3.x-dev.tar.gz">7.x-3.x-dev</a> version.<br /><br /><a href="http://drupal.org/project/resource_conflict">Resource Conflict</a> USED to be a module that detected booking conflicts in resources, and threw a form error. Resources were node reference field entries, and it supported date and event modules for the date/time. Resource Conflict version 3 is built on Entities and Rules,&nbsp;so the behavior is now totally customizable. This lets it support a wide variety of use cases.<br /><br /><b>How to use it</b><br />Out of the box, the module lets you enable Content Types for resource conflict checking, and you select which date field to use for each enabled content type. You do all this on the Content Type&#8217;s edit page.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-4twPmZsdmzM/T9kP9pKUeqI/AAAAAAAAABU/WplXGL8Ocfo/s1600/Screen+shot+2012-06-14+at+12.10.43+AM.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="380" src="http://1.bp.blogspot.com/-4twPmZsdmzM/T9kP9pKUeqI/AAAAAAAAABU/WplXGL8Ocfo/s640/Screen+shot+2012-06-14+at+12.10.43+AM.png" width="640" /></a></div><br /><br /><br />The module comes with a sample Rule for you, which throws a form error any time you try to save a Resource Conflict enabled node with a date that overlaps another Resource Conflict enabled node.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-4NAMGMI4658/T9kQ20ThSRI/AAAAAAAAABc/LOy6nHdUDy8/s1600/Screen+shot+2012-06-14+at+12.14.34+AM.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="364" src="http://4.bp.blogspot.com/-4NAMGMI4658/T9kQ20ThSRI/AAAAAAAAABc/LOy6nHdUDy8/s640/Screen+shot+2012-06-14+at+12.14.34+AM.png" width="640" /></a></div><br />But this is not a very realistic use case. More likely you will want to edit the rule to add some more conditions - for example, maybe a resource conflict on your site means overlapping taxonomy terms. Or entity references. Or titles. Or anything at all!<br /><br />To give an example of how complex this can go - on a site I recently launched, I have two kinds of resource conflict events. &#8220;Hard&#8221; conflicts are when two bookings at the same time reference the same user or taxonomy term. &nbsp;Hard conflicts throw a form error and prevent saving the node.&nbsp;This is just like the above case, and it&#8217;s a really simple modification on the default Rule. &nbsp;&#8220;Soft&#8221; conflicts are when you try to book a taxonomy term that is a parent or child of a term in an existing booking, or a user who is tagged with a term or child of a term that is already booked. For example, maybe I try to book the taxonomy term &#8220;Maintenance&#8221;, but the sub-term &#8220;Plumbers&#8221; is already booked at the same time. Or maybe I try to book John Doe, who is tagged as a &#8220;Plumber&#8221;, but Maintenance is already booked at that time. &nbsp;Soft conflicts can be booked, but they create a node to record the conflict.<br /><br />Other people have asked about using the module to integrate with Organic Groups, or to control bookings of finite resources - you could easily use Rules to build those functionalities. Best of all, it&#8217;s all exposed and easy for you to maintain.<br /><br />Here&#8217;s a run down of the Rules components included with <a href="http://drupal.org/project/resource_conflict">Resource Conflict 7</a>:<br /><ul><li><b>EVENT: A Resource Conflict Node Form is Validated</b>: This rule fires during node form validation on Resource Conflict enabled content types. You should use this event if you want to set form errors, or if you want to interact with Rules_forms module. It provides both a node object of the node being created/edited and a form object for use with rules_forms. This is the event trigger for the default Rule.</li><li><b>CONDITION: Contains a Resource Conflict:</b> Evaluate a node object for conflicts. Returns TRUE if there are conflicts for the node.</li><li><b>ACTION: Load a List of Conflicting Nodes</b>: Creates a list of nodes that conflict with the given node.</li><li><b>ACTION: Set a Form Validation Error</b>: Stores a form validation error to be fired the next time a validation hook is called on a conflict-enabled node. This is intended for use with the &#8220;A Resource Conflict Node Form is Validated&#8221; Event.</li></ul><div><br /></div><div><b>Future plans</b></div><div><b><br /></b></div><div>I&#8217;m pretty happy with this initial dev release; it solves a lot of problems quite elegantly. But there are a few remaining. Here are the items I&#8217;m planning on knocking out first.</div><div><ul><li><b>Drupal 6 backport:</b>&nbsp;I&#8217;ll release a 6.x-3.x branch which uses Rules for reactions. The biggest issue here is that <a href="http://drupal.org/project/rules_forms">rules_forms module</a> doesn&#8217;t exist for D6, which makes it impossible to throw a form validation error from within Rules. I may have to write a custom Rules action to do this.</li><li><b>Full Entities integration:</b>&nbsp;I&#8217;d like to generalize the module out to support ALL fieldable entities.&nbsp;</li><li><b>Better Integration with rules_forms</b>: rules_forms is pretty cool, and even cooler is the new version they&#8217;re working on, that doesn&#8217;t rely on the &#8220;form&#8221; Rules object. I&#8217;m looking forward to this, because it means we&#8217;ll be able to do cooler things with resource_conflict.</li></ul><div><br /></div></div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/06/drupal-developers-toolkit-handy-tools.html">Drupal Developers&#8217; Toolkit: Handy Tools and Functions to Make Your Life Easier</a></h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2012-06-08T17:23:00+02:00" pubdate data-updated="true">Jun 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content">
<div class="css-full-post-content js-full-post-content">
Drupal is big and complex, and no matter how good you are, you will need to debug. Before you get started coding for a Drupal site, you should download and enable the very useful <a href="http://drupal.org/project/devel">devel</a> module on your dev site. Go ahead, I&#8217;ll wait.<br /><br />This primer covers all the tools that I&#8217;ll use in later tutorials on this blog. In the real world I end up using 5-6 of these guys regularly. Learn them. They help.<br /><h3>    drupal_set_message()</h3><div>Printing a message is the basic tool of any debugging, and you need to know this core function. This lets you print a message to the page, Drupal-style. Usage: drupal_set_message($message, $severity).</div><div><br /></div><div><code>drupal_set_message(t('Hello %name!', array('%name' =&gt; 'John Doe')), 'warning');</code>&nbsp;</div><div><br /></div><div>Note that I use the t() function to process text in drupal_set_message. This is partly because the function itself doesn&#8217;t do any text sanitizing, so it&#8217;s good practice to insert a layer there. It&#8217;s also because you can&#8217;t &nbsp;insert variables directly into the message, and t() is a convenient way of doing that.</div><div><br /></div><div>Note that drupal_set_message() does not do well with large messages - it is not recommended to print big arrays directly to the message area. For that, we&#8217;ll use another function:</div><h3>    dpm()</h3><div>This sets a variable of your choice to Drupal&#8217;s messaging system, in a nice compact output handled by krumo.&nbsp;</div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-H4xCqcjlhF8/T9IuHpEFIMI/AAAAAAAAAA8/lctbEESP66E/s1600/Screen+shot+2012-06-08+at+6.53.24+PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="289" src="http://3.bp.blogspot.com/-H4xCqcjlhF8/T9IuHpEFIMI/AAAAAAAAAA8/lctbEESP66E/s320/Screen+shot+2012-06-08+at+6.53.24+PM.png" width="320" /></a></div><div>Most of Drupal is understandable and learnable on the fly with just this simple tool. Usage: dpm($variable, $name = NULL).</div><div><br /></div><div><code>dpm($node, 'This is the node variable');</code></div><div><br /><h3>   kpr()</h3><div>Just like dpm, but it prints to the page header rather than the Drupal message area. Helpful when your theme doesn&#8217;t print messages. You can also have it return a string instead of printing it automatically, which comes in handy in some fairly bizarre circumstances. Usage: kpr($variable, $return = FALSE, $name = NULL).&nbsp;</div><div><br /></div><div><code>kpr($node, FALSE, 'This is the node variable');</code></div><div><br /></div><h3>   dvm()</h3><div>OK, you don&#8217;t like krumo. Maybe you&#8217;re a masochist, or maybe you have some esoteric requirements to deal with. Either way, you want dvm(). It prints variables in a more traditional format into the message area. I have used this to get variables into pastebin, very helpful when asking for help on Drupal IRC channels. :) Usage: dvm($variable, $name = NULL).</div><div><br /></div><div><code>dvm($node, 'This is the node variable');</code></div><h3>   dpr()</h3></div><div>If your theme doesn&#8217;t display messages, dpr() prints variables to the page header without krumo. Same usage case as above. Just like kpr(), you can return a string with this function. Usage: dpr($variable, $return = FALSE, $name = NULL).</div><div><br /></div><div><code>dpr($node, FALSE, 'This is the node variable');</code></div><div><br /></div><div><h3>  dargs()</h3></div><div>This guy shows you the arguments passed into the current function, using krumo for readability. This is my go-to function when using Drupal hooks. The API documentation is great, but there&#8217;s nothing like simply seeing the variables you have to work with. Usage: dargs()</div><div><br /></div><code>function swearing_custom_form_alter(&amp;$form, &amp;$form_state, $form_id) {<br />&nbsp; dargs();<br />}</code><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-N3-bpT3pgeI/T9Iy8ptSNkI/AAAAAAAAABI/FnlybyhHqeQ/s1600/Screen-shot-2012-06-08-at-7.12.02-PM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="297" src="http://4.bp.blogspot.com/-N3-bpT3pgeI/T9Iy8ptSNkI/AAAAAAAAABI/FnlybyhHqeQ/s320/Screen-shot-2012-06-08-at-7.12.02-PM.png" width="320" /></a></div><div><h3> dd()</h3></div><div>For those awful times when a hook doesn&#8217;t produce direct output, there&#8217;s always dd(). This guy prints a given variable to a file called &#8220;drupal_debug.txt&#8221; in your site&#8217;s temporary files directory. This comes in very handy. Usage: dd($variable, $name = NULL)</div><div><br /></div><div><code>dd($node, 'This is the node variable');</code></div><div><br /></div><h3> ddebug_backtrace()</h3><div>This prints a backtrace for the current function in krumo, in the head of your current page. Devel module comes with the ability to enable this automatically for fatal errors, but occasionally you just want to see how things work. Usage: ddebug_backtrace().</div><div><br /></div><h3> db_queryd()</h3><div>This tool is handy for testing queries. Devel also has the ability to display a query log at the bottom of every page, showing every query with a time-to-execute. That can be pretty overwhelming. db_queryd() lets you put in a single query and see if your database spits out any errors. Usage: db_queryd($query, $arguments = array())</div><div><br /></div><div><br /></div>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/04/drupal-quick-learning-guides-custom.html">Drupal Quick Learning Guides: Custom Modules</a></h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2012-04-23T16:17:00+02:00" pubdate data-updated="true">Apr 23<span>rd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content">
<div class="css-full-post-content js-full-post-content">
Ah, it&#8217;s nice to be done with the basic structure stuff. At this point, I&#8217;m going to assume that you know the basics of how to administer a Drupal site. You understand the <a href="http://swearingatcomputers.blogspot.com/2012/04/drupal-quick-learning-guides-drupal.html">file structure</a>, you know where to go to download <a href="http://drupal.org/project/themes">themes</a> and <a href="http://drupal.org/project/modules">modules</a>, and you know how to make sites out of the big pieces you can find that way. Awesome. This is where it gets fun.  I&#8217;m going to assume some basic knowledge of PHP, but there&#8217;s nothing here that you can&#8217;t pick up with some quick glances over at <a href="http://w3schools.com/php/">w3schools</a>, and maybe some experimentation on your own.<br /><br />I mentioned in the file structure post that the whole point of Drupal is that Everything Is Override-able. If you want to customize the site beyond what you get out of the box with some contributed modules, you&#8217;re going to want to do it in your own module. That&#8217;s right - it&#8217;s incredibly easy to write your own Drupal module to insert whatever code you want into your particular Drupal site. In fact, it&#8217;s the recommended way to customize your site, because it means that your code won&#8217;t get mixed up with anything in Drupal&#8217;s &#8220;core&#8221;. If you update Drupal, you don&#8217;t have to worry about refactoring your patches or anything like that, you&#8217;ve got one place to look for your custom behavior. More importantly, if someone else comes along to take care of the site after you&#8217;re off the project, there&#8217;s only one place for them to look for customizations.<br /><br /> A module at its most basic consists of a directory under sites/whatever/modules , a self-named .info file giving basic information about the module, and a self-named .module file with your code in it. In this quick learning guide, we&#8217;ll build a &#8220;Hello World&#8221; module that prints some text on every page load. This is a quick guide - I&#8217;ll get more into how to leverage Drupal in your code in later posts.<br /><br /> So let&#8217;s create your custom module. Consider your module&#8217;s name - Drupal has a single namespace for all modules and features, and it&#8217;s easy to get confused with the theme namespace as well, so it&#8217;s best to pick a name that is definitely not going to be used by any modules, features, or themes. Most big shops will have a custom module for most any site they build, and they just name it &#8220;Sitename Custom&#8221; or something similar. We&#8217;re going to make a module called &#8220;Swearing Custom&#8221;, to follow that convention.<br /><br /> First create the module directory. I like to keep my custom modules all under sites/all/modules/custom . Drupal will search subdirectories, so take advantage of that fact to keep your codebase tidy! We&#8217;ll create the directory sites/all/modules/swearing_custom . Note the underscore instead of a space.<br /><br /> Then create the module&#8217;s .info file. This file informs Drupal about your module&#8217;s name, description, requirements, and other fundamentals. I like to think of it as anything that will go on the site&#8217;s Modules listing. This file has to be named after the module, just like the directory was. Here&#8217;s my swearing_custom.info file:<br /><br /> <code>name = Swearing at Computers Custom Module description = Custom tweaks and functionality for Swearing at Computers project = "swearing_custom" version = "7.x-1.x-dev" core = "7.x" package = "custom" dependencies[] = token </code><br /><br /> Most of those variables can be omitted, to be honest. All Drupal REALLY needs is name, description, project, and core. Notice how I defined a dependency, just for fun. I also like to put my custom code into a module group called &#8220;custom&#8221;, so my modules list stays nice and tidy.  The norm is to add to the dependencies array with one dependency per line, for readability. You can similarly have a files[] array to add your own files to the module. By default this contains just the .info and  .module files, which is all we&#8217;re using so I&#8217;m not adding a files[] line at all.<br /><br /> Now we&#8217;ll create the module file itself. This is just a php file, with an opening  tag. The trouble is, how do you get your code to run? You can write all the functions you want, but how should Drupal know to call your code?<br /><br /> Aha, now we get to the interesting bit. Drupal modules are built around a system of &#8220;hooks&#8221;. Each module defines a set of hooks, places for you to insert your custom code. And this isn&#8217;t an edge case - it&#8217;s totally core to how Drupal works. Big modules will have tens of hooks at your disposal&#8230; but we&#8217;ll cover those a bit later. For now, we&#8217;re just going to use one simple hook to get our &#8220;Hello world&#8221; code displayed: <a href="http://api.drupal.org/api/drupal/modules%21system%21system.api.php/function/hook_init/7">hook_init()</a>.<br /><br /> All hooks are named hook_something. It&#8217;s how you know it&#8217;s a hook. All the core hooks, and many of the contributed hooks, are documented on Drupal&#8217;s excellent <a href="http://api.drupal.org/">API resource site</a>. When you&#8217;re writing your custom module, you just declare a function named after the hook, replacing the word &#8220;hook&#8221; with your module&#8217;s name. Drupal will find that function and run it for you. Simple as that.<br /><br /> Hook_init() is called early in the page build process, on every page of your site. This is a very powerful hook, usually used to define variables that you&#8217;ll use later on. But we&#8217;re just going to use it to print a message to the screen. To start with, my swearing_custom.module file looks like this:<br /><br /> <code>/**   * Implementation of hook_init().  */ swearing_custom_init() {   print "Hello world!"; } </code><br /><br />Pretty simple, right? That comment at the top is the standard format for Drupal. It&#8217;s so that you can easily find where you used particular hooks (or where other contrib modules used them!), and it&#8217;s used for a lot of Drupal&#8217;s automated help and API resources. It&#8217;s also nice and tidy, so it&#8217;s a good habit to get into.<br /><br /> Then you see that I just declared a function named after the hook, added my code, and got out of there. At this point, if I enable this custom module I&#8217;ll see &#8220;Hello world&#8221; in unformatted text at the top of every page. Simple, but ugly.<br /><br /> Enter another great feature of Drupal: a million and one helper functions. These are also well documented at <a href="http://api.drupal.org/">api.drupal.org</a>, and they&#8217;re the functions that everyone - even Drupal&#8217;s core itself - uses to get things done in a standardized way. For example, I hate the way that text appears. So let&#8217;s update the module to use Drupal&#8217;s own messaging system. This means using <a href="http://api.drupal.org/api/drupal/includes%21bootstrap.inc/function/drupal_set_message/7">drupal_set_message()</a>. Have a look at the API page to see the arguments for this function, but 90% of your use cases will be following this example. Here&#8217;s a new version of swearing_custom.module:<br /><br /> <code>/**   * Implementation of hook_init().  */ swearing_custom_init() {   print "Hello world!";   drupal_set_message('Hello world!', 'status'); } </code><br /><br />That second argument tells Drupal the severity of the message: &#8216;status&#8217;, &#8216;warning&#8217;, or &#8216;error&#8217;. Status is actually the default, so I&#8217;ll cut it out of the next iteration of this code. The module now prints your message in a fancy, Drupal formatted way. It looks just like all the other Drupal modules, because that&#8217;s how all of Drupal displays messages. <br /><br /> I&#8217;m going to add one more layer of complexity here, with the <a href="http://api.drupal.org/api/drupal/includes%21bootstrap.inc/function/t/7">t()</a> function. You&#8217;ll see t() everywhere: it&#8217;s the way you declare text strings to Drupal as user-facing text. It makes the text available for translation, and makes it easy to sanitize any variables or user-entered text. An example t() string would be:<br /><br /> <code>t('Welcome to %sitename', array('%sitename' =&gt; 'Swearing at Computers'); </code><br /><br /> You just include replacement patterns in the text itself, and then declare them in an array. The replacement strings get sanitized, so that&#8217;s the right place to include user-entered text, URLs, or just variable output in general. So here is a final version of our custom module, using drupal_set_message() the way it was intended.<br /><br /> <code>/**   * Implementation of hook_init().  */ swearing_custom_init() {   print "Hello world!";   drupal_set_message(t('Hello world! This is %name!', array(%name =&gt; 'Swearing at Computers'))); } </code><br /><br /> That&#8217;s it for this quick guide. The basics of writing a module. The hardest part here is figuring out which hooks to use. Google is your friend: try searching for things like &#8220;drupal views hooks&#8221; to see how to tweak Views at various stages, or &#8220;drupal form hooks&#8221; to see how forms work in Drupal. Or don&#8217;t - I&#8217;ll be covering some of those hooks in the next posts.
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/04/drupal-quick-learning-guides-drupal.html">Drupal Quick Learning Guides: Drupal Structure</a></h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2012-04-16T14:01:00+02:00" pubdate data-updated="true">Apr 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content">
<div class="css-full-post-content js-full-post-content">
I&#8217;ve been lax about posting lately, and to make this easier on myself I think I&#8217;ll post a bunch of quick guides for basic coding procedures with Drupal. Simple things and concepts, explored in just enough detail for you to understand how it works, resource links so you can actually go and put it into practice. <br /><br />The first thing you need to understand about Drupal is the structure. Drupal is a modular Content Management System, built on PHP and whatever-database-you-want-which-is-probably-mysql-lets-face-it. Drupal <=6.x actually requires MySQL or PostGres, and they're still the standard on 99% of installs you'll face.  The thing is, Drupal is incredibly flexible and capable. And the trick to coding with Drupal is to code WITH Drupal, not against it. There are tons of helper functions built in that make your life easier, if only you'll work the way Drupal expects you to work. So this first post is about how Drupal expects you to work.  Drupal itself is a complicated guy that lives in several php files and directories. You are expected to NEVER touch any of these files or directories yourself. Seriously. 16,000 coders can't be wrong, just leave it the fuck alone. You have access to OVERRIDE anything and everything that Drupal does though, and you can do that from a nice contained subdirectory where you can keep an eye on your code. This is the /sites subdirectory.  See, one Drupal codebase can actually host many websites. Each one gets its own subdirectory under /sites. for example, I might have:  /sites/swearingatcomputers.blogspot.com /sites/subdomain.swearingatcomputers.blogspot.com /sites/swearingatcomputers.blogspot.com.subdirectory  The directory name tells Drupal what incoming requests should be forwarded to which site. You can see how subdomains and subdirectories are handled in the naming convention, too. Pretty easy stuff. There's also a special subdirectory for "default", and one for "all". Not to complicated to figure out: "all" is for code that applies to all your sites, and "default" is the sites subdirectory for when other names don't match.  I'll tell you a pro secret: hardly any of the big shops ever actually use the multi-site capability. In practice it's a pain in the ass to remember which sites use which version of which module, and Drupal itself doesn't take up any significant space. So most of us just set up a separate Drupal codebase for each site, and use sites/default and sites/all for our code.  Inside each site directory you'll find:  * settings.php : This contains the database connection information, and any special settings that Drupal needs for similar low-level tasks. Set once, never modified. Doesn't exist in sites/all. * files : Any user-uploaded files. This one doesn't exist in the sites/all directory. * modules : any modules that are available to Drupal. This is where you'll keep the <a href="http://drupal.org/project">contributed modules</a> which are the majority of Drupal&#8217;s capabilities. <br />* themes : This contains the themes - layouts - that are available to Drupal. <br /><br />I mentioned that most professional Drupal shops just use a separate codebase for each site they set up. They also don&#8217;t mix and match between using sites/default and sites/all . This is because it&#8217;s very easy to end up with a copy of the same module in two places, and it&#8217;s hard to know which version Drupal is actually using. So everyone standardizes their own practice here. Personally, I keep modules and themes in sites/all . sites/default only contains settings.php and the files directory.<br /><br />Inside the modules directory you&#8217;ll find all your contributed modules that you&#8217;ve downloaded. But this is also where you have to keep <a href="http://drupal.org/project/features">Features</a> (exportable collections of settings, very useful!) and any custom code that you write for your site. This presents a namespace problem. What if you create a feature called &#8216;Views&#8217;, to hold all the Drupal Views you have? You don&#8217;t want to include it in the directory for the Views module&#8230; So underneath sites/all/modules , I create subdirectories custom_features and custom_modules. It&#8217;s still not good practice to have duplicate module or feature names though, so it&#8217;s wise to prefix your custom work with custom_ or the name of the project.<br /><br />That&#8217;s all you need to know about the Drupal file structure. Once again, NEVER EVER HACK CORE. Don&#8217;t touch anything outside of the &#8216;sites&#8217; directory, and you&#8217;ll be OK. There is always a way to override any behavior you like from inside the &#8216;sites&#8217; directory, and that will make your life MUCH easier down the road, trust me.
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/03/on-drupal-entities-or-how-organic.html">On Drupal Entities, or How Organic Groups and Taxonomy Are the Same Thing</a></h1>
    
    
      <p class="meta">
        








  



  
<time datetime="2012-03-25T12:58:00+02:00" pubdate data-updated="true">Mar 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content">
<div class="css-full-post-content js-full-post-content">
I&#8217;m a big fan of the new Entities model for Drupal. I&#8217;ve been working a lot with it lately, and it makes a lot of sense&#8230; but my favorite part is how it keeps blowing away my old assumptions, inherited from 7 years of Drupal experience. <br /><br />Here&#8217;s a big one that got me recently: Organic Groups is useless, because it&#8217;s basically Taxonomy with a couple of neat add-ons. Or Organic Groups is incredibly useful, however you choose to think about it. <br /><br />Let&#8217;s think about Taxonomy from the perspective of what it actually accomplishes. It&#8217;s a fieldable (thanks D7) way to group content. Each Taxonomy Term is an object on its own, which is referenced by other content to provide groupings. There&#8217;s nothing there that you can&#8217;t do with a generic entity, entityreference module, and a block view on taxonomy landing pages. <br /><br />In D4-D6, Taxonomy was the best way to categorize content, especially if you want that categorization to be hierarchical in nature. Period. In D7&#8230; meh. You can build an entity that replaces taxonomy incredibly easily. In this sense, Taxonomy is useless. It could be removed from Drupal core, and treated as a great example of a well fleshed out Entity that fills a common use case. I look forward to seeing taxonomy reference replaced by entityreference, which will make the transformation complete.<br /><br />ON THE OTHER HAND, having this pre-built entity is incredibly useful. Because Taxonomy IS a good implementation of the Entity model, it is flexible enough to obsolete a lot of more complex modules in a lot of use cases&#8230; and saves you a fair amount of coding and configuration in the meanwhile. <br /><br />Now, I am a huge fan of Organic Groups, and in D6 it was the number one way to give flexible content groupings with any kind of membership. It always bugged me how much configuration you had to do for the simplest of Group structures, though. And in D7&#8230; now you can do a lot of what Organic Groups does with the Taxonomy Entity. I didn&#8217;t think this was so until I really thought it through, and had an example to work with.<br /><br />So I had a site where we wanted to provide schedules for every user on the site, and allow Events to be scheduled for arbitrary groups as well. Each group should have a landing page with its own calendar for the group and all sub-groups. For example, the group calendar for &#8220;Company Executive&#8221; should include events for &#8220;Vice Presidents&#8221;, &#8220;Chiefs&#8221;, and &#8220;Chairpeople&#8221;. Group membership is all centrally managed. And if you&#8217;re a member of a group, you should receive update emails for every event that gets added to your group. <br /><br />In D6 this was a perfect use case for Organic Groups. In D7, I decided to do this with taxonomy instead. Why? The Ux for hierarchy creation and management is better in taxonomy because of the vast contrib ecosystem for it. What I would have built with Views, EntityReference, and custom code for nice hierarchical Ux in OG, is 80% built for me from day 1 with Taxonomy. Just apply the &#8220;Groups&#8221; taxonomy to the user object and the content types you want, and bam - you&#8217;ve just put Users and Content into semantic groups together. That&#8217;s what OG, at it&#8217;s core, provided for us in D6&#8230; and with some pre-built Views, is all it provided for a lot of projects.<br /><br />This led me down an interesting path of thought. What is the point of OG, if Taxonomy can duplicate its functionality so handily? <br /><br />And it dawned on me: all Organic Groups really offers is a fieldable Entity that interacts with Permissions in a way that is common for user-created groups. We could do this with Taxonomy and some custom code: write a module that offers permission limitations based on taxonomy term association with the user object, and then include a nice UI for adding terms to your user object by clicking a link on the taxonomy term page&#8230; you&#8217;ve got a solid competitor for OG. And at that point, I would start saying things like &#8220;why did you bother using Taxonomy, when OG would have done it out of the box?&#8221;<br /><br />And I think that&#8217;s when I really got the power of entities. We&#8217;ve been used to seeing modules as a way to provide extra capabilities to Drupal. They can still do that, of course. But many of the best modules will just offer pre-configured Entities for popular use cases. Like an Entity that groups users and content, offers a way for users to join groups conveniently, and gives Permissions ramifications for group membership. Or an entity that lets you group other entities semantically into a hierarchy. The complex Organic Groups and the simple Taxonomy are only a couple of steps removed from each other&#8230; and both great examples of Entities in action.
</div>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/6/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>A little something about me.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/02/11/a-year-between-the-cracks-of-decoupled-drupal/">Six Months Between the Cracks of Decoupled Drupal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/05/writing-drupal-8-code-for-drupal-7/">Writing Drupal 8 Code for Drupal 7</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/31/developer-options-for-replacing-your-old-macbook-pro/">Developer Options for Replacing Your Old MacBook Pro</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/15/perfect-linux-mint-macbook-pro-9-2/">Perfect Linux Mint on My Macbook Pro 9,2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/13/getting-my-notes-out-of-evernote/">Getting My Notes Out of Evernote</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/ohthehugemanatee">@ohthehugemanatee</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ohthehugemanatee',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




<section>
<a class="twitter-timeline"  href="https://twitter.com/campbellvertesi"  data-widget-id="407927984901746688">Tweets by @campbellvertesi</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

    </section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Campbell Vertesi (ohthehugemanatee) -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'ohthehugemanatee';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
